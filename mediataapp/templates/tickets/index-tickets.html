{% extends '../_layout/base.html' %}

{% block conteudo %}
<!-- Main Content -->

<div class="d-flex justify-content-between align-items-center mb-3">
    <span class="fs-2">Tickets</span>

    <a href="{% url 'cadastro-ticket' %}" class="btn btn-warning rounded-pill">
        Adicionar ticket <i class="bi bi-plus-lg"></i>
    </a>
</div>

<div class="row mb-3">
    <div class="col-md-4">
        <label for="filtro-status" class="form-label">Filtrar por Status</label>
        <select id="filtro-status" class="form-select">
            <option value="">Todos</option>
            <option value="Executado">Executado</option>
            <option value="Em execução">Em execução</option>
            <option value="Cotação">Cotação</option>
            <option value="Levantamento">Levantamento</option>
            <option value="Aprovado">Aprovado</option>
            <option value="Finalizado">Finalizado</option>
            <option value="Vistoriado">Vistoriado</option>
            <option value="Rejeitado">Rejeitado</option>
        </select>
    </div>
</div>

<div class="table-responsive small">
    <table class="table table-striped table-sm w-100" style="table-layout: fixed;" id="datatablesSimple">
        <thead>
            <tr>
                <th scope="col">Ticket</th>
                <th scope="col">Colaborador</th>
                <th scope="col">Cliente</th>
                <th scope="col">Criação</th>
                <th scope="col">Finalização</th>
                <th scope="col">Status</th>
                <th scope="col">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td>{{ ticket.ticket }}</td>
                <td>Antunes Teixeira</td>
                <td>MA 0094</td>
                <td>{{ ticket.data_criacao|date:"d/m/Y H:i" }}</td>
                <td>{{ ticket.data_finalizar|date:"d/m/Y" }}</td>
                <td>
                    {% if ticket.status == 'E' %}
                    <span class="badge text-bg-warning">Executado</span>
                    {% endif %}
                    {% if ticket.status == 'X' %}
                    <span class="badge text-bg-warning">Em execução</span>
                    {% endif %}
                    {% if ticket.status == 'C' %}
                    <span class="badge text-bg-info">Cotação</span>
                    {% endif %}
                    {% if ticket.status == 'L' %}
                    <span class="badge text-bg-info">Levantamento</span>
                    {% endif %}
                    {% if ticket.status == 'A' %}
                    <span class="badge text-bg-secondary">Aprovado</span>
                    {% endif %}
                    {% if ticket.status == 'F' %}
                    <span class="badge text-bg-dark">Finalizado</span>
                    {% endif %}
                    {% if ticket.status == 'V' %}
                    <span class="badge text-bg-success">Vistoriado</span>
                    {% endif %}
                    {% if ticket.status == 'R' %}
                    <span class="badge text-bg-light">Rejeitado</span>
                    {% endif %}
                </td>
                <td>
                    <div class="d-flex gap-1 flex-wrap">
                        <a href="{% url 'exibir-ticket' ticket.key %}" class="btn btn-primary btn-sm"><i
                                class="bi bi-eye"></i></a>
                        <a href="{% url 'editar-ticket' ticket.key %}" class="btn btn-success btn-sm"><i
                                class="bi bi-pencil-square"></i></a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        const tabela = $('#datatablesSimple').DataTable({
            language: {
                search: "Pesquisar:",
                lengthMenu: "Mostrar _MENU_ registros por página",
                info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
                paginate: {
                    first: "Primeiro",
                    last: "Último",
                    next: "Próximo",
                    previous: "Anterior"
                },
                zeroRecords: "Nenhum resultado encontrado",
            }
        });

        // Filtro por Status (coluna 4 – index começa em 0)
        $('#filtro-status').on('change', function () {
            let valor = $(this).val();
            tabela.column(4).search(valor).draw();  // 4 = Status
        });
    });
</script>

{% endblock %}